
<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <script src="../../script/api.js"></script>
    <style>
    body{background: #ffffff}
#bingtutitle{ padding-left: 48px; padding-top: 16px}
#bingtutitle ul li{ line-height: 2}
#bingtutitle ul li span{display: inline-block; width: 16px; height: 16px; margin-bottom: -3px}
    </style>
</head>
<body>
    <div style="height: 32px"></div>
    <canvas id="bingtu" style="margin: auto;display: block;"></canvas>
    <div id="bingtutitle">
        <ul>

        </ul>
    </div>
                </body>
                </html>
<script>
function drawCircle(data,color,radius){
    var canvas = document.getElementById("bingtu");
    canvas.width=radius;
    canvas.height=radius;
    radius=radius/2;
    var ctx = canvas.getContext("2d");
    var startPoint= 1.5 * Math.PI;
        for(var i=0;i<data.length;i++){
                ctx.fillStyle = color[i];
                ctx.strokeStyle = color[i];
                ctx.beginPath();
                ctx.moveTo(radius,radius);
                ctx.arc(radius,radius,radius,startPoint,startPoint-Math.PI*2*(data[i]/100),true);
                ctx.fill();
                ctx.stroke();
                startPoint -= Math.PI*2*(data[i]/100);
        }
}
function start(){
    setBounce(reStart);
    var url=createUrl('caiwu',{'fun':'shouyi'});
    getJson(url,'数据获取中',function(data){
        if(data.s==1){
            var title=data.r.title;
            var color = data.r.color;
            var shouyi=data.r.shouyi;
            var zongshouyi=0;
            var html='';
            for(var i in shouyi){
                zongshouyi+=shouyi[i];
            }

            var data=[];
            for(var i in shouyi){
                if(zongshouyi==0){
                    t=0;
                }else{
                    var t=shouyi[i]/zongshouyi*100;
                    t=t.toFixed(2);
                    t=parseFloat(t);
                }
                data.push(t);
                html+='<li><span style="background: '+color[i]+';"></span>'+title[i]+'：'+shouyi[i]+'元（'+t+'%）</li>';
            }
            $('#bingtutitle ul').html(html);
            var w=$('body').width();
            w=w*0.8;
            if(zongshouyi==0){
                for(var i in data){
                    data[i]=100/data.length;
                }
            }
            drawCircle(data,color,w);
        }else{
            openAlert(data.r);
        }
    });
}

ready(function(){
    setTitle('收益分布');
    start();
},1);
</script>
