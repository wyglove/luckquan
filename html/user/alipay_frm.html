
<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <script src="../../script/api.js"></script>
    <style>
    .sc-text{ width: 80px; text-align: right}
    .bc-btn{background: #F60; border: 1px solid #F60; color: #FFFFFF; font-weight: bold}
    </style>
</head>
<body>
<form id="regsubfrom" onSubmit="return sub();">
<div class="mdmlogin">
	<div class="zhanghao" style="border-bottom:0"><input type="number" value="" name="mobile" id="mobile" readonly></div>
	<div class="zhanghao hide"><input type="text" placeholder="短信码" style="width:96px" name="dxm" id="dxm" ><input data="0" type="button" value="发送短信码" class="loginbtn" id="jym" getYzmTime="0" YZM_EFFE="60" YZM_EFFE_USE="60" onClick="yzm_dxm.getDxm()"></div>
	<div class="zhanghao"><input type="text" name="alipay" id="alipay" placeholder="请输入支付宝"></div>
	<div class="zhanghao"><input type="text" name="realname" id="realname" placeholder="请输入姓名"></div>

	<input type="submit" value="设置" class="loginbtn">
</div>
</form>
<script>
function sub(){
    var alipay=$('#alipay').val();
    var realname=$('#realname').val();
    var mobile=$('#mobile').val();
    var dxm=$('#dxm').val();
    var url=createUrl('user',{'fun':'alipayUpdate','alipay':alipay,'realname':realname,'mobile':mobile,'dxm':dxm});
    getJson(url,'数据提交中',function(data){
        if(data.s==1){
            user.alipay=alipay;
            user.realname=realname;
			updateUser(user);
            updateUserIndex();
            var from=get('from',1);
            if(from!=''){
                var winName=get('winName',1);
                var popName=get('popName',1);
                api.execScript({
                    name: winName,
                    frameName: popName,
                    script: 'start()'
                });
            }
            toast('修改成功',1000,function(){
                closeWin();
            });
        }else{
            openAlert(data.r);
        }
    },0);
    return false;
}

function start(){
    user=checkLogin();
    if(user.mobile=='' || user.mobile==0){
        toast('请先设置手机',1000,function(){
            set('from','mobile');
            set('winName',api.winName);
            set('popName',api.frameName);
            openPage(['user','mobile','手机设置']);
        });
    }
	if(user.alipay=='' || typeof user.alipay=='undefined'){
		$('.hide').hide();
	}else{
		$('.hide').show();
	}
    $('#alipay').val(user.alipay);
    $('#realname').val(user.realname);
    $('#mobile').val(user.mobile);
}
ready(function(){
    setTitle('支付宝设置');
    start();
},1);
</script>
