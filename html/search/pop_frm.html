
<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <script type="text/javascript" src="../../script/api.js"></script>
    <style>
        body {
            background: #ffffff;
            font-size: 16px
        }

        .resou {
            margin: 16px 8px 8px 16px;
        }

        .resoulist {
            margin-top: 16px;
        }

        .resou font {
            font-size: 14px;
            color: #999
        }

        .resoulist li {
            background-color: #f4f4f4;
            color: #333333;
            padding: 5px 16px;
            border-radius: 13px;
            float: left;
            margin: 0 8px 16px 0;
            cursor: pointer;
        }

        .resoulist li.current {
            color: #eb5655;
        }

        #zidong {
            width: 90%;
            margin: auto;
            z-index: 99;
            display: none
        }

        .arrow-up {
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 10px solid rgba(194, 185, 29, 0.2);
            margin-left: 40px;
        }

        .bc-text {
            color: #656565
        }
        .aui-list .aui-list-item-title{max-width: 80%; white-space:nowrap;word-break:break-all; text-overflow:ellipsis;overflow:hidden;}

        .searchtab{display: -webkit-flex;display: flex; margin: 8px;}
.searchtab .sealist{flex: 1; -webkit-flex: 1;text-align: center;padding: 8px 0;}
.searchtab .sealist.cur{border-bottom: 2px solid #f93c40;}
    </style>

    <body>
        <div id="iosheader" style="height:0px; background:#FFFFFF; width:100%"></div>
        <div>
            <form onSubmit="return search()">

                <header style="background:#FFFFFF;border-bottom: 1px solid #F2F2F2;">
                        <div class="topbar">
                            <div class="egret-img fl" tapmode="hover" onClick="guanbi()">
                                <div><span style="color:#999;" class="iconfont">&#xe607;</span></div>
                            </div>
                            <div class="egret-img fr" tapmode="hover" onClick="search()">
                                <div><span style="color:#999;" class="iconfont">&#xe68d;</span></div>
                            </div>
                            <div class="egret-header-box" tapmode>
                                <div class="egret-header-search">
                                    <input id="q" style="background: #F4F4F4;border-radius: 16px;font-size: 14px;padding-bottom:5px" type="search" placeholder="粘贴宝贝标题 先领券后购物">
                                </div>
                            </div>
                        </div>
                    </header>
            </form>
<div id="zidong" style="display:none" tapmode onclick="$(this).hide();search($('#tishi').html())">
<div class="arrow-up"></div>
<div style=" background-color:#fffacc; -webkit-border-radius:0.4em; font-size:0.8em; padding:0.8em 0; color:#000000; position:relative">
<span style="display:inline-block; overflow:hidden;text-indent:0.6em; color:#f60 ">您可能想买：</span><a class="tishi" id="tishi" style="color:#f60; width:65%;text-decoration:underline; display:inline-block;overflow: hidden; white-space: nowrap !important;text-overflow: ellipsis; text-indent:0;"></a>
<div style="position:absolute; right:0; top:0; font-size:1.5em; padding:0.5em" tapmode class="iconfont guanbi" onclick="$('#zidong').hide();cancelBubble();">&#xe622;</div>
</div>
</div>

<div id="search-tip" style="display:none;position:relative; z-index:9">
<div style="position:absolute; right:0.5em; top:0;z-index: 11;-webkit-transform: rotate(45deg);font-size: 1.5em;" ontouchend="closeSearchTip()">+</div>
<div style="position:absolute; top:0; left:0; width:100%; z-index:10; background:#FFF">
<ul style="display: block;width: 80%;margin: auto;line-height: 3;padding-top: 0.5em;padding-bottom: 0.5em;">
</ul>
</div>
</div>
<div class="searchtab" id="searchtab"></div>

            <div class="resou" style="border-bottom:1px solid #F2F2F2">
                <font>热搜</font>
                <ul class="resoulist" id="resoulist"></ul>
                <div style=" clear:both"></div>
            </div>

            <div class="resou">
                <font>搜索记录</font>
            </div>
            <div class="search_log" style="padding: 0 16px">
                <ul class="aui-list aui-list-in" id="search_log">

                </ul>
            </div>

            <div style="text-align: center;margin-top:32px;">
                <span tapmode onClick="searchLog.del()" id="del_search_log" style="color:5f646e; border:1px solid #F60; font-size:16px; padding:8px; display:none; color:#F60;width: 80%;margin: auto;border-radius: 10px;"><span class=" iconfont fa-1x">&#xe606;</span>清空搜索历史记录</span>
                <div style="height:24px">&nbsp;</div>
            </div>
        </div>
    </body>
    <script>
        var searchType='taobao',from; //淘宝  京东  拼多多
        var safeAreaTop = localStorage.getItem('safeAreaTop');
        document.getElementById('iosheader').style.height=safeAreaTop+'px';

        function set_tab($t,type){
            searchType=type;
            $('.sealist').removeClass('cur');
            $t.addClass('cur');
        }

        function popClose(time){
            time=time||0;
            setTimeout(function(){
                api.execScript({
                    script: 'window.pop="";'
                });
                api.closeFrame();
            },time);
        }

        function guanbi() {
            if (api.systemType == 'ios' && from=='' && BAR_COLOR==0) { //表示从首页来的
                api.setStatusBarStyle({ //状态栏黑色
                    style: 'light'
                });
            }
            popClose(100);
        }

        function focusInput() {
            // 使用模块弹出键盘
            var softInput = api.require('softInputMgr');
            softInput.toggleKeyboard();
            // 将相应的输入框获取焦点
            document.getElementById("q").focus();
        }

        function hotSearch() {
            var data = appInfo.hot;
            var html = '';
            for (var i in data) {
                if(data[i]!=''){
                    html += '<li tapmode onclick="search(\'' + data[i] + '\')">' + data[i] + '</li>';
                }
            }
            $api.dom('#resoulist').innerHTML = html;
        }

        function search(q){
            q=q||$api.dom('#q').value;
            if(q==''){
                openAlert('搜索内容不能为空',function(){
                    // focusInput();
                });
                //toastOpen('搜索内容不能为空',1000);
            }else{
                api.setFrameAttr({
                    name: api.frameName,
                    hidden: true
                });
                searchLog.add(q);
                ddevent.search(searchType,q,from);
                setTimeout(function(){
                    api.closeFrame();
                },500);
            }
            return false;
        }

        function ddRequest(obj){
            getAjax(obj.url,function(data){
                obj.success(data);
            },obj.tip,obj.cacheTime);
        }

        function closeSearchTip(){
        	$('#search-tip').hide();
        	$('#search-tip ul').html('');
        	$('#q').val('');
        }

        function getSearchTip(q){
            q=$api.trim(q);
            if(q==''){
                return false;
            }
        	var url='https://suggest.taobao.com/sug?code=utf-8&q='+urlencode(q);
        	var html='';
        	var obj={
                url:url,
                dataType:'json',
                tip:'数据获取中',
                cacheTime:3600,
        		jiacan:1,
                success:function(data){
                    for(var i in data.result){
        				html+='<li ontouchend="search(\''+data.result[i][0]+'\');" style="list-style: none;text-overflow: ellipsis;overflow: hidden;white-space: nowrap;">'+data.result[i][0]+'</li>';
        			}
                    $('#search-tip').show().find('ul').html(html);
                }
            };
            ddRequest(obj);
        }

        function openInput() {
            var offset = $('#q').offset();
            var rect = {
                x: offset.left,
                y: offset.top,
                w: offset.width,
                h: offset.height
            }
            var UIInput = api.require('UIInput');
            UIInput.open({
                rect: rect,
                styles: {
                    bgColor: '#F4F4F4'
                },
                autoFocus: true,
                placeholder: '粘贴宝贝标题 先领券后购物',
                keyboardType: 'search',
                alignment: 'center',
                fixedOn: api.frameName,
                fixed: false
            }, function(ret) {
                console.log(JSON.stringify(ret));
                if (ret.eventType == 'change') {
                    UIInput.value(function(ret) {
                        if (ret && ret.status) {
                            getSearchTip(ret.msg);
                            $('#q').val(ret.msg); // uiinput值改变后赋给input，方便search();
                        }
                    });
                } else if (ret.eventType == 'search') {
                    search();
                }
            });
        }

        function start() {
            var html='';
            for(var i in webMalls){
                html+='<div class="sealist" id="'+i+'" ontouchend="set_tab($(this),\''+i+'\');">'+webMalls[i]+'</div>';
            }
            $('#searchtab').html(html);

            from=api.pageParam.from;
            searchType=from.replace(/\/.*/,'');
            if(searchType==''){
                searchType='taobao';
            }
            $('#'+searchType).addClass('cur');

            if (api.systemType == 'ios') {
                api.setStatusBarStyle({ //状态栏黑色
                    style: 'dark'
                });
            } else {
                if(BAR_COLOR==0){
                    var body = $api.dom('body');
                    $api.append(body, '<div style="position:fixed;top:0;width:100%;height:' + get('safeAreaTop') + 'px;background-color:#000000">&nbsp;</div>');
                }
            }
            // setTimeout(function() {
            //     focusInput();
            // }, 400);
            openInput();

            hotSearch();
            searchLog.init();
             clipboardGet(function(data){
                if(data!='' && data!=null && data.length<100){
            		$zidong=$('#zidong');
            		$zidong.show();
            		$zidong.find('#tishi').html(data);
            	}
            });

          //   $("#q").on('input propertychange',function(){
        	// 	getSearchTip($(this).val());
        	// });

            api.parseTapmode();
        }

        ready(function(){
            start();
        },1);

    </script>

</html>
