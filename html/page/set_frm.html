<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <script src="../../script/api.js"></script>
    <style>
    .aui-list .zhuti,.aui-list .yincang{min-height: 0; height: 0px;overflow: hidden;}
    </style>
</head>

<body>
    <ul class="aui-list aui-list-in">

        <li class="aui-list-item zhuti" tapmode onclick="updateTpl()">
            <div class="aui-list-item-label-icon">
                <i class="iconfont">&#xe65e;</i>
            </div>
            <div class="aui-list-item-inner aui-list-item-arrow">
                <div class="aui-list-item-title">当前主题</div>
                <div class="aui-list-item-right">
                    <div class="aui-badge" style="position:relative;top:0; left:0" id="hothao"></div>
                </div>
            </div>
        </li>

        <li class="aui-list-item yincang" tapmode onclick="updateBanben()">
            <div class="aui-list-item-label-icon">
                <i class="iconfont">&#xe621;</i>
            </div>
            <div class="aui-list-item-inner aui-list-item-arrow">
                <div class="aui-list-item-title">当前版本</div>
                <div class="aui-list-item-right">
                    <div class="aui-badge" style="position:relative;top:0; left:0" id="banbenhao"></div>
                </div>
            </div>
        </li>

        <li class="aui-list-item" tapmode onclick="delcache()">
            <div class="aui-list-item-label-icon">
                <i class="iconfont">&#xe606;</i>
            </div>
            <div class="aui-list-item-inner aui-list-item-arrow">
                <div class="aui-list-item-title">清除缓存</div>
                <div class="aui-list-item-right">
                    <div class="aui-badge" style="position:relative;top:0; left:0" id="cacheSize"></div>
                </div>
            </div>

        </li>

        <li class="aui-list-item yincang" tapmode onclick="taobaofangshi()">
            <div class="aui-list-item-label-icon">
                <i class="iconfont">&#xe637;</i>
            </div>
            <div class="aui-list-item-inner aui-list-item-arrow">
                <div class="aui-list-item-title">淘宝启动方式</div>
                <div class="aui-list-item-right" id="taobaofangshi">

                </div>
            </div>
        </li>

        <li class="aui-list-item yincang" tapmode onclick="openPage('user','about')">
            <div class="aui-list-item-label-icon">
                <i class="iconfont"></i>
            </div>
            <div class="aui-list-item-inner aui-list-item-arrow">
                <div class="aui-list-item-title">关于我们</div>
                <div class="aui-list-item-right">

                </div>
            </div>
        </li>

        <li class="aui-list-item yincang" tapmode onclick="openPage('user','xieyi')">
            <div class="aui-list-item-label-icon">
                <i class="iconfont"></i>
            </div>
            <div class="aui-list-item-inner aui-list-item-arrow">
                <div class="aui-list-item-title">用户协议</div>
                <div class="aui-list-item-right" >

                </div>
            </div>
        </li>

        <div tapmode onclick="tongjidianji()"  style="height:500px;"></div>
    </ul>
</body>
<script>
var dianjicishu=0;
function tongjidianji(){
	dianjicishu++;
    if(dianjicishu==5){
        $('.yincang').removeClass('yincang');
        $('.zhuti').removeClass('zhuti');
    }
    setTimeout(function(){
        dianjicishu=0;
    },5000);
}

    ready(function() {
        setTitle("更多");
        if (iosShenhe() == 0) {
            $('.yincang').removeClass('yincang');
        }
        var DD_tplVerson = ddInt(get('DD_tplVerson'));
        $('#zhutihao').html('V ' + DD_tplVerson);
        $('#banbenhao').html(api.appVersion);
        if(api.systemType=='ios'){
            $('#hothao').text(HOT_VERSION_IOS);
        }else{
            $('#hothao').text(HOT_VERSION_ANDROID);
        }
        console.log(JSON.stringify(api));
        var openTb = get('DD_openTb');
        if (openTb == 'shouTao') {
            $('#taobaofangshi').html('启动手淘模式');
        } else if (openTb == 'h5') {
            $('#taobaofangshi').html('内部浏览模式');
        } else if (openTb == 'sysTao') {
            $('#taobaofangshi').html('手机系统模式');
        } else {
            $('#taobaofangshi').html('默认模式');
        }

        var cache=0;
		var _cache;
		var storage = window.localStorage;
        var k=0;
		for(var i in storage){
            if(i.length>30){
                _cache=storage.getItem(i);
                if(_cache!=null){
                    cache+=_cache.length;
                }
            }
		}
		cache=cache/1048576*2;
		cache=cache.toFixed(2);
		$('#cacheSize').html(cache+'M');
    }, 1);

    function taobaofangshi() {
        api.actionSheet({
            title: '淘宝购物模式',
            cancelTitle: '取消',
            destructiveTitle: '',
            buttons: ['启动手淘模式', '内部浏览模式', '手机系统模式']
        }, function(ret, err) {
            if (ret.buttonIndex == 1) {
                set('DD_openTb', 'shouTao');
                $('#taobaofangshi').html('启动手淘模式');
            } else if (ret.buttonIndex == 2) {
                set('DD_openTb', 'h5');
                $('#taobaofangshi').html('内部浏览模式');
            } else if (ret.buttonIndex == 3) {
                set('DD_openTb', 'sysTao');
                $('#taobaofangshi').html('手机系统模式');
            }
        });
    }

    function updateBanben() {
        if (api.systemType == 'ios') {
            if (appVersion() > appInfo.ios_banben) {
                toast('当前已是最高版本');
            } else {
                set('updateTip', 0);
                versionUpdate.check();
            }
        } else {
            if (appVersion() > appInfo.android_banben) {
                toast('当前已是最高版本');
            } else {
                set('updateTip', 0);
                versionUpdate.check();
            }
        }

        return false;

        var downloadManager = api.require('downloadManager');
        api.execScript({
            script: "appInterface='down'"
        });
        downloadManager.enqueue({
            url: 'http://download.taobaocdn.com/wireless/taobao4android/latest/taobao4android_703304.apk',
            savePath: 'fs://test.apk',
            cache: false,
            allowResume: true,
            title: '教程',
            iconPath: 'widget://res/img/weixin.png',
            networkTypes: 'all'
        }, function(ret, err) {
            api.execScript({
                script: "appInterface=''"
            });
            if (ret) {
                //alert(JSON.stringify(ret));
            } else {
                //alert(JSON.stringify(err));
            }

            downloadManager.openManagerView({
                title: '下载管理'
            }, function(ret, err) {
                if (ret) {
                    //alert(JSON.stringify(ret));
                } else {
                    //alert(JSON.stringify(err));
                }
            });
        });


    }

    function delcache() {
        // alert(api.deviceId);
        // api.execScript({
        //     script: "appInterface='down'"
        // });
        // var downloadManager = api.require('downloadManager');
        // downloadManager.openManagerView({
        //     title: '下载管理'
        // }, function(ret, err) {
        //     api.execScript({
        //         script: "appInterface=''"
        //     });
        //     if (ret) {
        //         //alert(JSON.stringify(ret));
        //     } else {
        //         //alert(JSON.stringify(err));
        //     }
        // });
        // return false;
        set('DD_jianqieban',"");
        toastOpen('删除缓存');
        clear(1);
        if (api.systemType == 'ios') { //苹果下因为有2个浏览器引擎，所以删H5除缓存需要首页再触发一次
            api.execScript({
                name: 'root_root',
                frameName: 'index_index_frm',
                script: "clear(1)"
            });
        }
        api.clearCache(function() {
            var fs = api.require('fs');
            fs.rmdir({
                path: 'fs://down'
            }, function(ret, err) {
                toastClose();
                openAlert('清除完成');
            });
        });
    }

    function updateTpl() {
        openConfirm('检测主题','',['更新主题','恢复主题','取消'],function(data){
            if(data==1){
                downloadTpl(function(version, update, msg) {
                    if (version == 0) {
                        openAlert('主题解析失败');
                    } else if (version == -1) {
                        openAlert('当前已是最新主题');
                    } else {
                        set('DD_tplVerson', version);
                        $('#zhutihao').html('V ' + version);
                        api.confirm({
                            title: '主题更新完成',
                            msg: '是否重启APP',
                            buttons: ['取消', '确定']
                        }, function(ret, err) {
                            if (ret.buttonIndex == 2) {
                                api.execScript({
                                    name: 'root',
                                    script: 'reStart();'
                                });
                            }
                        });
                    }
                }, 1);
            }else if(data==2){
                set('DD_tplVerson', 0);
            }
        })

    }
</script>

</html>
