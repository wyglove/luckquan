
<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title></title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <script src="../../script/api.js"></script>
</head>
<body>
<div id="wrap" class="flex-wrap flex-vertical">
    <header style="background: #FFFFFF;color:#5f646d;border-bottom: 1px solid #f2f2f2">
            <div class="topbar">
                <div id="left" style="color:#5f646d;position:relative" tapmode="hover" class="egret-img fl" onClick="leftClick()">
                    <span class="iconfont">&#xe607;</span>
                </div>
                <div id="cha" style="color:#5f646d;position:relative; width:30px" tapmode="hover" class="egret-img fl" onClick="closeWin()">
                    <span class="iconfont">&#xe622;</span>
                </div>
                <div id="right" style="color:#5f646d" class="egret-img fr" tapmode="hover" onclick="rightClick()">
                    <span class="iconfont">&#xe669;</span>
                </div>
                <div style="color:#5f646d" class="egret-img fr" tapmode="hover">
                </div>
                <div tapmode="hover" style="display: -webkit-flex;display: flex;-webkit-align-items: center;align-items: center;height: 100%;color:#333;justify-content: center;" class="egret-header-box"><div id="title" style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;"><span style="text-indent:-100px">&nbsp;</span></div></div>
            </div>
        </header>
    <div id="main" class="flex-con">

    </div>
    <div id="footer"></div>
</div>
</body>
</html>
<script type="text/javascript">
    var browser,url,leftFun=0,frmArr=[];

    ready(function(){
        url=api.pageParam.url;
        if(url=='' || typeof url=='undefined'){
            openAlert('网址未定义');
        }
        headerFuns('url');
        browser = api.require('webBrowser');
        var offset = $api.offset($api.dom('#main'));
        browser.openView({
            url: url,
            rect: {
                marginLeft: 0,
                marginTop: offset.t,
                marginBottom: 0,
                marginRight: 0
            },
            headers:{
            }
        }, function(ret, err) {
            switch (ret.state) {
                case 0:
                    //console.log('0:'+ret.url);
                    url=ret.url;
                    break;
                case 1:
                    break;
                case 2:
                    // browser.loadScript({
                    //      script: "alert(document.cookie);alert(navigator.userAgent);"
                    // });
                    break;
                case 3:
                    setTitle(ret.title);
                    break;
                case 4:
                //console.log('4:'+ret.url);
                    break;
                default:
                    break;
            }
        });
    },0,function(){
        var title=getGlobalData('title');
        if(title!=''){
            document.getElementById('title').innerHTML = title;
        }
    });

    function setTitle(title){
        var lanjie='';
        if(title.indexOf('##')>0){
            var a=title.split('##');
            lanjie=a[1];
            title=a[0];
            if(lanjie=='null' || lanjie=='undefined'){
                lanjie='';
            }
        }
        $api.dom('#title').innerHTML=title;
        if(lanjie!=''){
            alert('拦截内容：'+lanjie);
        }
    }

    function leftClick(){
        if(frmArr.length>0){
            closeFrm(frmArr[frmArr.length-1])
        }else{
            browser.historyBack(
                function(ret, err) {
                    if (!ret.status) {
                        closeWin();
                    }
                }
            );
        }
    }

    function closeFrm(name){
        for(var i in frmArr){
            if(frmArr[i]==name){
                frmArr.splice(i,1);
            }
        }
        api.closeFrame({'name':name});
    }

    function rightClick(){
        share('','','','','page_url');
    }
</script>
